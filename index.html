<!--
Workflow Automation System Frontend

This is the main frontend interface for the AI-powered workflow automation system.
It provides a comprehensive web UI for:

1. Workflow Creation:
   - Natural language workflow descriptions
   - AI-powered code generation using Anthropic Claude
   - Real-time status updates and code preview

2. File Management:
   - Drag-and-drop file uploads
   - File attachment to workflow queries
   - Integration with LightOn Paradigm API for document processing

3. Workflow Execution:
   - Execute workflows with user queries
   - Support for attached documents
   - Real-time execution monitoring with detailed logs

4. Monitoring and Debugging:
   - Comprehensive API call logging
   - Step-by-step workflow execution tracking
   - Error handling and user feedback

Key Features:
- Cross-domain API integration with CORS support
- Real-time logging with color-coded output
- Responsive design with modern CSS styling
- File drag-and-drop with visual feedback

Architecture:
- Pure vanilla JavaScript (no frameworks)
- REST API integration with fetch()
- Modular function design for maintainability
- Comprehensive error handling and user feedback
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflow Automation Test</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">

    <!-- External stylesheets -->
    <link rel="stylesheet" href="frontend/styles/main.css">
    <link rel="stylesheet" href="frontend/styles/steps.css">
    <link rel="stylesheet" href="frontend/styles/console.css">
</head>
<body>
    <h1>
        <img src="/lighton-logo.png" alt="LightOn Logo">
        <span>workflow builder</span>
    </h1>

    <!-- Step 1: Describe Workflow -->
    <div class="container">
        <h2>1. Describe Workflow</h2>
        <p>Describe your desired workflow in natural language:</p>
        <textarea id="rawWorkflowDescription" placeholder="Example: I want to search for documents about my question and then analyze them to provide a summary..." style="color: #999;"></textarea>
        <button onclick="enhanceWorkflowDescription()">Enhance Description</button>

        <div id="enhancedDescriptionResult" style="margin-top: 15px;"></div>
        <div id="enhancedDescription" style="display: none;"></div>
    </div>

    <!-- Step 2: Create Workflow -->
    <div class="container">
        <h2>2. Create Workflow</h2>
        <p>Review and optionally edit the enhanced workflow description:</p>
        <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; font-size: 13px; color: #666;">
            <strong>Available tools:</strong> document upload, chat, document search, document analysis, image analysis<br>
            <strong>üìö API Reference:</strong> Detailed information about endpoints, parameters, and responses can be found in the <a href="https://paradigm.lighton.ai/api/schema/swagger-ui/#/" target="_blank" style="color: #007bff;">Paradigm API Swagger documentation</a><br>
            <strong>üí° Tip:</strong> Use Step 1 above to get an enhanced workflow description, or manually enter your workflow here.
        </div>
        <textarea id="workflowDescription" placeholder="Example: Search for documents about LightOn, then analyze those documents to summarize key information..." style="color: #999;"></textarea>
        <input type="text" id="workflowName" placeholder="Workflow name (optional)" />
        <button onclick="createWorkflow()">Create Workflow</button>

        <!-- Tip about document storage -->
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #2196f3;">
            <strong>üí° Tip:</strong> If your workflow processes documents, they will be stored in your private Paradigm workspace. To avoid storing documents permanently, add a final step to your workflow description: "Delete all input documents after processing."
        </div>

        <div id="workflowResult"></div>
    </div>

    <!-- Step 3: Test Workflow -->
    <div class="container">
        <h2>3. Test Workflow</h2>
        <p>Enter your query and optionally attach documents:</p>

        <!-- Query Input -->
        <input type="text" id="testQuery" placeholder="What is LightOn's main technology platform?" />

        <!-- Document Upload Section -->
        <div style="margin: 15px 0;">
            <label style="display: block; margin-bottom: 8px; font-weight: bold;">üìé Attach Documents (Optional):</label>
            <div class="file-upload-area" id="queryUploadArea" ondrop="handleQueryDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <p>üìé Drag and drop files here or <button onclick="document.getElementById('queryFileInput').click()">browse files</button></p>
                <input type="file" id="queryFileInput" multiple style="display: none;" onchange="handleQueryFileSelect(event)">
                <p style="font-size: 12px; color: #666;">Upload documents to analyze with your query</p>
                <p style="font-size: 11px; color: #888; margin-top: 5px;">Note: In this demo, attached documents will be automatically deleted after workflow execution.</p>
            </div>

            <div id="queryUploadStatus"></div>
            <ul class="file-list" id="queryFilesList"></ul>
        </div>

        <button onclick="executeWorkflowWithQuery()" id="testButton" disabled>Test Workflow</button>
        <div id="testResult" style="margin-top: 15px;"></div>
    </div>

    <!-- Step 4: Update Workflow -->
    <div class="container">
        <h2>4. Edit workflow</h2>
        <p>Edit the workflow description above and regenerate the workflow to refine its behavior. You can modify the natural language description to add new steps, change the logic, or improve the workflow based on your test results. After testing, go back to step 1 or 2, update your workflow description, and regenerate to create an improved version.</p>

        <!-- Monitoring Helper Section -->
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
            <h3 style="color: #666; font-size: 16px; margin-bottom: 15px;">üìä Monitor Workflow Execution</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Monitor every step of workflow execution with detailed information:</p>
            <ul style="font-size: 12px; color: #666; margin: 10px 0;">
                <li>üîç API endpoints called and payloads sent</li>
                <li>üìä Document IDs, file IDs, and search queries</li>
                <li>üí¨ Response content and analysis results</li>
                <li>üìÑ Document chunks and file processing details</li>
                <li>‚ö° Step-by-step workflow execution flow</li>
                <li>‚ùå Error handling and fallback mechanisms</li>
            </ul>
            <button onclick="clearLogs()" class="clear-logs">Clear Logs</button>
            <div class="logs-container" id="logsContainer">
                <div class="log-entry">
                    <span class="log-timestamp">[Ready]</span> <span class="log-response">Waiting for API activity...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 5: Deploy Workflow API -->
    <div class="container">
        <h2>5. Deploy your workflow API endpoint</h2>
        <p>Deploy your workflow as a standalone API endpoint that can be called from external applications.</p>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
            <h3>Option A: Deploy on Vercel (Recommended for quick setup)</h3>
            <ol style="margin-left: 20px;">
                <li><strong>Create a new directory for your API:</strong> Create a new folder on your computer for this deployment</li>
                <li><strong>Install Vercel CLI:</strong> If you haven't already, install Vercel CLI by running: <code>npm install -g vercel</code></li>
                <li><strong>Login to Vercel:</strong> Run <code>vercel login</code> and follow the prompts to connect your GitHub account</li>
                <li><strong>Create your API file:</strong> Create <code>api/workflow.py</code> with your generated code plus these imports:</li>
            </ol>
            <pre style="background: #fff; padding: 10px; border-radius: 4px; overflow-x: auto;"><code>from http.server import BaseHTTPRequestHandler
import json
import os
from typing import Dict, Any

# IMPORTANT: Add your Paradigm API key here
# You can get this from your Paradigm admin interface
PARADIGM_API_KEY = "your-paradigm-api-key-here"

# Add your generated workflow code here
# ... (paste your generated code)

class handler(BaseHTTPRequestHandler):
    def do_POST(self):
        content_length = int(self.headers['Content-Length'])
        post_data = self.rfile.read(content_length)
        data = json.loads(post_data.decode('utf-8'))

        # Execute your workflow here
        result = execute_workflow(data.get('query', ''))

        self.send_response(200)
        self.send_header('Content-type', 'application/json')
        self.send_header('Access-Control-Allow-Origin', '*')
        self.send_header('Access-Control-Allow-Methods', 'POST, OPTIONS')
        self.send_header('Access-Control-Allow-Headers', 'Content-Type')
        self.end_headers()

        response = json.dumps({'result': result})
        self.wfile.write(response.encode())

    def do_OPTIONS(self):
        self.send_response(200)
        self.send_header('Access-Control-Allow-Origin', '*')
        self.send_header('Access-Control-Allow-Methods', 'POST, OPTIONS')
        self.send_header('Access-Control-Allow-Headers', 'Content-Type')
        self.end_headers()
</code></pre>
            <ol style="margin-left: 20px;">
                <li><strong>Add your Paradigm API key:</strong> Replace <code>"your-paradigm-api-key-here"</code> in the code above with your actual Paradigm API key</li>
                <li><strong>Deploy to Vercel:</strong> In your project directory, run <code>vercel --prod</code></li>
                <li><strong>Set environment variables:</strong> In the Vercel dashboard, go to your project settings ‚Üí Environment Variables and add your Paradigm API key</li>
                <li><strong>Get your API URL:</strong> After deployment, Vercel will show you your API URL. It will be something like: <code>https://your-project.vercel.app/api/workflow</code></li>
            </ol>

            <div style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #2196f3;">
                <strong>üí° Note:</strong> Vercel automatically detects Python files in the <code>api/</code> directory and deploys them as serverless functions. No <code>vercel.json</code> configuration is needed for basic deployments.
            </div>

            <div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #ffc107;">
                <strong>‚ö†Ô∏è Important:</strong> Make sure to add your Paradigm API key as an environment variable in the Vercel dashboard for security. Never commit API keys to your code.
            </div>

            <h3>Option B: Deploy on your own infrastructure</h3>
            <ol style="margin-left: 20px;">
                <li>Create a new Python file (e.g., <code>workflow_api.py</code>)</li>
                <li>Add these dependencies to your <code>requirements.txt</code>:</li>
            </ol>
            <pre style="background: #fff; padding: 10px; border-radius: 4px; overflow-x: auto;"><code>fastapi==0.104.1
uvicorn==0.24.0
python-multipart==0.0.6
aiohttp==3.9.1
python-dotenv==1.0.0</code></pre>
            <ol style="margin-left: 20px;">
                <li>Create your API file with this structure:</li>
            </ol>
            <pre style="background: #fff; padding: 10px; border-radius: 4px; overflow-x: auto;"><code>from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
import uvicorn
from typing import Optional
import os

# IMPORTANT: Add your Paradigm API key here
# You can get this from your Paradigm admin interface
PARADIGM_API_KEY = "your-paradigm-api-key-here"

# Add your generated workflow code here
# ... (paste your generated code)

app = FastAPI()

class WorkflowRequest(BaseModel):
    query: str
    user_id: Optional[str] = None

@app.post("/workflow")
async def execute_workflow_endpoint(request: WorkflowRequest):
    try:
        result = execute_workflow(request.query)
        return {"result": result, "status": "success"}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)</code></pre>
            <ol style="margin-left: 20px;">
                <li><strong>Add your Paradigm API key:</strong> Replace <code>"your-paradigm-api-key-here"</code> in the code above with your actual Paradigm API key</li>
                <li><strong>Install dependencies:</strong> Run <code>pip install -r requirements.txt</code></li>
                <li><strong>Run your API:</strong> Execute <code>python workflow_api.py</code></li>
                <li><strong>Access your API:</strong> Your API will be available at <code>http://your-server:8000/workflow</code></li>
            </ol>

            <div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #ffc107;">
                <strong>üîë Important:</strong> Make sure to add your Paradigm API key to the code before running. You can get this key from your Paradigm admin interface under API settings.
            </div>
        </div>
    </div>

    <!-- Step 6: Add to Paradigm -->
    <div class="container">
        <h2>6. Add your workflow to Paradigm</h2>
        <p>Paradigm has a feature called "Third Party Tools" that allows you to create custom tools within the Paradigm UI. When you use the tool, it will execute your deployed workflow.</p>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
            <h3>Step-by-step instructions:</h3>
            <ol style="margin-left: 20px;">
                <li><strong>Access Third Party Tools:</strong> In your Paradigm admin interface, navigate to the Third Party Tools section</li>
                <li><strong>Create New Tool:</strong> Click "Add Third Party Tool"</li>
                <li><strong>Fill in Basic Information:</strong>
                    <ul style="margin-left: 20px;">
                        <li><strong>Name:</strong> Give your workflow a descriptive name (e.g., "Document Analysis Workflow")</li>
                        <li><strong>Enabled:</strong> Check this box to activate the tool</li>
                        <li><strong>Description:</strong> Provide a detailed description of what your workflow does. Be specific about:
                            <ul style="margin-left: 20px;">
                                <li>What tasks it can perform</li>
                                <li>What types of queries it handles</li>
                                <li>Any limitations or requirements</li>
                                <li>Example use cases</li>
                            </ul>
                            <strong>Example:</strong> "This workflow analyzes documents and provides detailed summaries. It can search through uploaded documents, extract key information, and generate comprehensive analysis reports. Works best with text-based documents and specific questions about document content."
                        </li>
                    </ul>
                </li>
                <li><strong>HTTP Configuration:</strong>
                    <ul style="margin-left: 20px;">
                        <li><strong>HTTP Method:</strong> Select "POST" (since your workflow expects POST requests)</li>
                        <li><strong>Headers:</strong> Add any required headers (usually none needed for basic setup)</li>
                        <li><strong>Require Document:</strong> Set to "No" (tools currently can't retrieve uploaded docs from the Paradigm UI)</li>
                    </ul>
                </li>
                <li><strong>Creation Method:</strong> Select "Parameters/URL"</li>
                <li><strong>URL:</strong> Enter your deployed API endpoint URL:
                    <ul style="margin-left: 20px;">
                        <li>For Vercel: <code>https://your-project.vercel.app/api/workflow</code></li>
                        <li>For custom infrastructure: <code>http://your-server:8000/workflow</code></li>
                    </ul>
                </li>
                <li><strong>Parameters:</strong> Configure the parameters your API expects:
                    <ul style="margin-left: 20px;">
                        <li><strong>Body Parameters:</strong> Add a parameter named "user_input" of type "string" (or "query" in some cases, but generally "user_input" is what the endpoint expects)</li>
                    <li><strong>API Documentation:</strong> If deploying via FastAPI, you can view the full API documentation at "your API base URL/docs" (e.g., https://your-api.vercel.app/docs)</li>
                        <li>If your API expects additional parameters, add them as needed</li>
                    </ul>
                </li>
                <li><strong>Save and Deploy:</strong> Save your tool configuration, then navigate to Chat settings in the Paradigm admin and activate your third party tool using the arrow.</li>
            </ol>

            <div style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin-top: 15px;">
                <strong>üí° Important:</strong> The description you provide is crucial for tool routing. Paradigm uses this description to understand when to use your tool, so make it as detailed and accurate as possible.
            </div>
        </div>
    </div>

    <!-- Step 7: Test and Share -->
    <div class="container">
        <h2>7. üöÄ Test and share</h2>
        <p>You are now set up to use your workflow as a third party tool within Paradigm. The other users in your company can also access this tool, so spread the news and show them how it works!</p>
    </div>

    <!-- External JavaScript files - loaded in dependency order -->
    <script src="frontend/scripts/logging.js"></script>
    <script src="frontend/scripts/api.js"></script>
    <script src="frontend/scripts/files.js"></script>
    <script src="frontend/scripts/workflow.js"></script>
    <script src="frontend/scripts/ui.js"></script>
</body>
</html>
